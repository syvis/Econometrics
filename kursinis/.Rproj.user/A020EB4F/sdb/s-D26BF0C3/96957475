{
    "collab_server" : "",
    "contents" : "---\noutput:\n  pdf_document:\n    latex_engine: xelatex\n  html_document: default\n---\n\\begin{titlepage}\n\n\\centerline{\\bf \\large Vilniaus Universitetas}\n\\bigskip\n\\centerline{\\large \\textbf{Matematikos ir informatikos fakultetas}}\n\\bigskip\n\\centerline{\\large \\textbf{Ekonometrinės analizės katedra}}\n\n\\vskip 150pt\n\\centerline{\\bf \\Large \\textbf{Kursinis darbas}}\n\\vskip 50pt\n\\begin{center}\n    {\\bf \\LARGE Įskaitinių eismo įvykių Lietuvos keliuose analizė}\n\\end{center}\n\n\\vskip 150pt\n\\centerline{\\Large \\textbf{Atliko: Linas Šyvis ir Kornelijus Samsonas}}\n\\vskip 30pt\n\\centerline{\\Large \\textbf{Vadovas: prof. Vydas Čekanavičius}}\n\\vskip 120pt\n\\centerline{\\large \\textbf{VILNIUS 2016}}\n%\\newpage\n\\end{titlepage}\n\n\\textwidth 6.5in\n\\textheight 9.00in\n\n\\renewcommand{\\contentsname}{Turinys}\n\\tableofcontents\n\\thispagestyle{empty}\n\\newpage\n\n**Reikalingi užduotims paketai.**\n```{r, message=F, warning=F}\nlibrary(fpp)\nlibrary(dplyr)\n```\n\n\n**Nuskaitome duomenis.**\n```{r}\nrawdata <- read.csv2(\"2003-2015.csv\", header = T)\ngyventojai <- read.csv2(\"gyventojai.csv\", header = T, skip = 1)\nkor <- read.csv2(\"koreliacijos.csv\", header = T)\n```\n\n#Tvarkome duomenis\n\n**Paliekame tik 5 didžiuosius miestus**\n```{r, tidy = T}\nmiestai <- c(\"Vilniaus m. sav.\", \"Kauno m. sav.\", \"Klaipedos m. sav.\", \"Siauliu m. sav.\", \"Panevezio m. sav.\")\ndata <- subset(rawdata, Vieta %in% miestai)\n```\n\nTurime stulpelius \"Gimimo data\" ir \"Stazas\". Jų reikšmės tikėtinai stipriai koreliuoja, patikrinkime. Pertvarkysime stulpelio \"Gimimo data\" reikšmes taip, kad matytume eismo įvykio dalyvio amžių ir patikrinsime amžiaus koreliaciją su \"Stažo\" reikšmėmis.\n\n**Stulpelį \"Gimimo data\" pertvarkome į \"Amzius\".**\n```{r, tidy = T}\nAmzius <- as.numeric(format(Sys.Date(), format=\"%Y\")) - as.numeric(format(as.Date(data$Gimimo_data, format=\"%Y\"), format = \"%Y\"))\ndata <- cbind(data, Amzius)\n```\n\nDabar turime eismo įvykių dalyvių amžių, kuro koreliaciją su stažu galime patikrinti.\n\n**Patikrinsime koreliaciją.**\n```{r}\nsum(is.na(data$Stazas))\nsum(is.na(data$Amzius))\ncor(data$Amzius, data$Stazas, use = \"pairwise.complete.obs\")\n```\n\n#Tvarkom Blaivumo stulpelį\nMatome, kad stulpelį \"Blaivumas\" sudaro 6 skirtingos reikšmės. Sutrauksime jas visas į \"Blaivus\" ir \"Neblaivus\".\n```{r, tidy = T}\ndata[data[, \"Blaivumas\"] %in% c(\"Apsvaiges nuo narkotiniu, psichotropiniu ar kitu psichika veikianciu medziagu\", \"Atsisake buti patikrintas\", \"Neblaivus\"), \"Blaivumas\"] <- \"Neblaivus\"\ndata$Blaivumas <- factor(data$Blaivumas)\ntable(data$Blaivumas)\n```\n\n#Tvarkom Meteo salygų stulp.\n```{r}\ndata[data[, \"Meteorologines_salygos\"] == \"Lijundra\", \"Meteorologines_salygos\"] <- \"Lietus\"\ndata[data[, \"Meteorologines_salygos\"] == \"Puga\", \"Meteorologines_salygos\"] <- \"Sniegas, krusa\"\ndata$Meteorologines_salygos <- factor(data$Meteorologines_salygos)\ntable(data$Meteorologines_salygos)\n```\n\n\nKai kurie stulpeliai turi NA reikšmių, reikia jas pašalinti.\n```{r, tidy = T}\nsalinamieji <- c(\"Lytis\", \"Apgadintu_transporto_priemoniu_skaicius\", \"Pilietybe\", \"Neigalumas\", \"Blaivumas\", \"Amzius\")\nndata <- data[complete.cases(data[salinamieji]),]\nsapply(lapply(ndata, is.na), sum)\n```\n\nPašalinome NA reikšmes (stulpeliuose, kuriuose NA > 5000, NA palikome, kad neprarastume didžiosios dalies duomenų).\n\n5 didžiausius Lietuvos miestus lyginsime pagal įvykius 1000-iui gyventojų.\n\n**Sukuriame rodiklį 1000 gyventojų.**\n```{r}\ntukst <- gyventojai[,3]/1000\ngyventojai <- cbind(gyventojai, tukst)\n```\n\n#Įvykių sk. 1000-iui gyventojų didžiausiuose miestuose grafikas.\n\n**Skaičiuojame mėnesinį įvykių skaičių.\n```{r, tidy = T}\nby_month <- group_by(data, format(as.Date(data$Data, format=\"%Y-%m-%d\"),\"%Y-%m\"), Vieta)\nagreguoti <- summarise(by_month, sum(Kaltas), sum(Dalyviu_skaicius), sum(Suzeistu_skaicius), sum(Zuvusiu_skaicius))\ncolnames(agreguoti) <- list(\"Data\", \"Vieta\", \"Ivykiai\", \"Dalyviai\", \"Suzeisti\", \"Zuve\")\n```\n\n\n**Išsaugome didžiųjų miestų įvykių skaičių ir gyventojų laiko eilutes.\n```{r}\nivykiusk <- function(i)\n  ts(agreguoti[agreguoti$Vieta == i, \"Ivykiai\"], start=c(2003,1), frequency = 12)\n\ngyvsk <- function(i)\n  ts(rep(gyventojai[gyventojai$Vieta == i, \"Visi\"], each = 12), start = c(2003,1), frequency = 12)\n\nivykiai <- sapply(miestai, ivykiusk)\nnames(ivykiai)<-sprintf(miestai)\ngyven <- sapply(miestai, gyvsk)\nnames(gyven)<-sprintf(miestai)\n\ntukst <- function(i)\n  ivykiai[,i] * 1000 / gyven[,i]\n\ntukstgyv <- ts(sapply(miestai, tukst), start = c(2003,1), frequency = 12)\nnames(tukstgyv)<-sprintf(miestai)\n\n```\n\n**Brėžiame grafiką.**\n```{r}\nplot(0, type = \"n\", xlim = c(2003,2015), ylim = c(0,0.3), yaxs=\"i\", xaxs=\"i\", main = \"Įvykių skaičius 1000-iui gyventojų\", ylab = \"Įvykių sk. 1000 gyv.\", xlab = \"Laikas\", axes=F)\npar(xaxp=c(2003, 2015, 12), yaxp=c(0, 0.3, 6))\naxis(1)\naxis(2)\nfor(i in 1:5)\n  lines(tukstgyv[,i], col = i, lwd = 1)\nlegend(\"topright\", col = c(1:5), lty = 1, lwd = 1, legend = c(\"Vilnius\", \"Kaunas\", \"Klaipėda\", \"Šiauliai\", \"Panevėžys\"), pt.cex = 1, cex = 0.45, text.width = 1)\n```\n\n[Reikalingi komentarai]\n**Pagalbiniai stulpeliai**\n```{r}\ndiena <- ndata$Paros_metas == \"Diena\"\ndiena <- diena * 1\nmoteris <- ndata$Lytis == \"Moteris\"\nmoteris <- moteris * 1\nasfaltas <- ndata$Dangos_rusis == \"Asfaltbetonis, cementbetonis\"\nasfaltas <- asfaltas * 1\nzvyras <- ndata$Dangos_rusis == \"zvyrkelis\"\nzvyras <- zvyras * 1\nslapia <- ndata$Dangos_bukle == \"slapia\"\nslapia <- slapia * 1\ngiedra <- ndata$Meteorologines_salygos == \"Giedra\"\ngiedra <- giedra * 1\n\nndata <- cbind(ndata, diena, moteris, asfaltas, zvyras, slapia, giedra)\n```\n\n**Sukuriam miestų lenteles**\n```{r}\nby_year <- group_by(ndata, format(as.Date(ndata$Data, format=\"%Y-%m-%d\"),\"%Y\"), Vieta)\nmetiniai <- summarise(by_year, sum(Kaltas), sum(data$Blaivumas == \"Neblaivus\", na.rm=T), sum(diena)/sum(Kaltas), sum(moteris)/sum(Kaltas), sum(asfaltas)/sum(Kaltas), sum(zvyras)/sum(Kaltas), sum(slapia)/sum(Kaltas), sum(giedra)/sum(Kaltas))\ncolnames(metiniai) <- list(\"Data\", \"Vieta\", \"Ivykiai\", \"Neblaivus\", \"Diena\", \"Moteris\", \"Asfaltas\", \"Zvyras\", \"Slapia_danga\", \"Giedra\")\n\nvilnius <- data.frame(metiniai[metiniai$Vieta == \"Vilniaus m. sav.\", 5:10])\nkaunas <- data.frame(metiniai[metiniai$Vieta == \"Kauno m. sav.\", 5:10])\nsiauliai <- metiniai[metiniai$Vieta == \"Siauliu m. sav.\", 5:10]\npanevezys <- metiniai[metiniai$Vieta == \"Panevezio m. sav.\", 5:10]\nklaipeda <- metiniai[metiniai$Vieta == \"Klaipedos m. sav.\", 5:10]\n```\n\n```{r}\nchisq.test(vilnius[,i], kaunas[,i])\n\n```\n\nMatome, kad p-value < 0.05, vadinasi H0 atmetam. Proporcijos statistiškai reikšmingai skiriasi. Patikrinkime tarp kurių miestų proporcijos yra statistiškai reikšmingai skirtingos.\n\n```{r, warning = F, eval=F, echo=F}\npairwise.prop.test(tab, p.adjust.method = \"none\")\n```\n\nProporcijos statistiškai reikšmingai skiriasi tarp Šiauliu m. sav. ir Panevėžio m. sav. ir tarp Vilniaus m. sav. ir Panevėžio m. sav.\nPatikrinkime, ar Šiauliuose/Vilniuje įvykių dėl neblaivių vairuotojų kaltės yra statistiškai reikšmingai daugiau negu Panevėžyje.\n\n```{r, eval=F, echo=F}\ntab1 <-matrix(c(13, 90, 3, 93), nrow=2, byrow=T)\nprop.test(tab1, alternative = \"greater\")\n\ntab2 <-matrix(c(59, 434, 3, 93), nrow=2, byrow=T)\nprop.test(tab2, alternative = \"greater\")\n```\n\nPaaiškėjo, kad Šiauliuose/Vilniuje įvykių dėl neblaivių vairuotojų kaltės yra statistiškai reikšmingai daugiau negu Panevėžyje.\n\n\n#Tikrinam įvykių priklausomybę nuo amžiaus\n```{r, eval=F, echo=F}\nstazas <- cut(data[,24], breaks = c(0, 10, 20, 30, 40, 50, 60))\ntable(stazas)\n```\n\n\n#Forecastinam autoįvykius\n```{r, eval=F, echo=F}\nb <- ts(agreguoti[agreguoti[,3] == \"Vilniaus m. sav.\", 4], start=c(2009,1), frequency = 12)\nplot(b)\n```\n\n```{r, eval=F, echo=F}\nz <- auto.arima(b)\nplot(forecast(z, h = 12))\n#salinam sezona\nliek <- ts(z$residuals,start=c(2009,1), frequency = 12)\nstl <- stl(z$residuals, s.window=\"periodic\")\nser <- liek - stl$time.series[,\"seasonal\"]\nplot(ser)\n```\n\n\nTikrinsime hipoteze ar Vilniaus mieste eismo ivykiu kaltininkai dazniau yra Vyrai nei moterys.\n\nH0= V sk. = \n\n```{r, eval=F, echo=F}\nVilniusm <- rawdata[rawdata[,1] == \"Vilniaus m. sav.\",]\nKaunasm <- rawdata[rawdata[,1] == \"Kauno m. sav.\",]\nSiauliaim <- rawdata[rawdata[,1] == \"siauliu m. sav.\",]\nKlaipedam <- rawdata[rawdata[,1] == \"Klaipedos m. sav.\",]\nPanevezysm <- rawdata[rawdata[,1] == \"Panevezio m. sav.\",]\n\n```\n\n\n### Kaltininku procentas miestuose (Vyrai/Moterys)\n\nKaltininku procentas Vilniaus mieste.\n\n```{r, eval=F, echo=F}\nvyruskV<-sum(na.omit(as.numeric(Vilniusm[,19]==\"Vyras\")))\nmoteruskV<-sum(na.omit(as.numeric(Vilniusm[,19]==\"Moteris\")))\nvisoV<-(vyruskV+moteruskV)\nvyruprocV=vyruskV/visoV*100\nmoteruprocV=moteruskV/visoV*100\n```\n\nKaltininku procentas Kauno mieste.\n\n```{r, eval=F, echo=F}\nvyruskK<-sum(na.omit(as.numeric(Kaunasm[,19]==\"Vyras\")))\nmoteruskK<-sum(na.omit(as.numeric(Kaunasm[,19]==\"Moteris\")))\nvisoK<-(vyruskK+moteruskK)\nvyruprocK=vyruskK/visoK*100\nmoteruprocK=moteruskK/visoK*100\n```\n\nKaltininku procentas Siauliu mieste.\n\n```{r, eval=F, echo=F}\nvyruskS<-sum(na.omit(as.numeric(Siauliaim[,19]==\"Vyras\")))\nmoteruskS<-sum(na.omit(as.numeric(Siauliaim[,19]==\"Moteris\")))\nvisoS<-(vyruskS+moteruskS)\nvyruprocS=vyruskS/visoS*100\nmoteruprocS=moteruskS/visoS*100\n```\n\n\nKaltininku procentas Klaipedos mieste.\n\n```{r, eval=F, echo=F}\nvyruskKl<-sum(na.omit(as.numeric(Klaipedam[,19]==\"Vyras\")))\nmoteruskKl<-sum(na.omit(as.numeric(Klaipedam[,19]==\"Moteris\")))\nvisoKl<-(vyruskKl+moteruskKl)\nvyruprocKl=vyruskKl/visoKl*100\nmoteruprocKl=moteruskKl/visoKl*100\n```\n\nKaltininku procentas Panevezio mieste.\n\n```{r, eval=F, echo=F}\nvyruskP<-sum(na.omit(as.numeric(Panevezysm[,19]==\"Vyras\")))\nmoteruskP<-sum(na.omit(as.numeric(Panevezysm[,19]==\"Moteris\")))\nvisoP<-(vyruskP+moteruskP)\nvyruprocP=vyruskP/visoP*100\nmoteruprocP=moteruskP/visoP*100\n```\n\n\n\nTikrinsime hipoteze ar Vilniaus mieste eismo ivykiu kaltininkai dazniau yra Vyrai nei moterys.\n\n```{r, eval=F, echo=F}\nVilniusm <- rawdata[rawdata[,1] == \"Vilniaus m. sav.\",]\nsum(Vilniusm[,\"Lytis\"]==\"Vyras\")\n```\n\n#koreliacijos\n```{r, eval=F, echo=F}\n\nkor1 <- kor[-c(1,2,3),-c(1,2,3,5,8)]\nkor1[,4] <- as.numeric(levels(kor1[,4]))[kor1[,4]]\ncor(kor1)\n```\n\n\nPalyginti zuvusiu/suzeistu menesinius vidurkius tarp laikotarpiu ir vietu.\nAr skiriasi ivykiu skaicius nakti ir diena?\n\n\\newpage\n\n#Literatūra\n\n* https://www.epolicija.lt/atviri-duomenys\n* http://osp.stat.gov.lt\n* http://www.lakd.lt\n* http://www.lkpt.lt",
    "created" : 1476954767562.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3973445534",
    "id" : "96957475",
    "lastKnownWriteTime" : 1476954816,
    "last_content_update" : 1476954816972,
    "path" : "~/GitHub/Econometrics/kursinis/kursinis2.0.Rmd",
    "project_path" : "kursinis2.0.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}